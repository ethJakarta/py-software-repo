<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel - Software Repo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="bg-light">
<div class="container mt-5">
    <h2 class="mb-4">üì¶ Admin - Kelola Software</h2>

    <!-- FORM TAMBAH SOFTWARE -->
    <form id="addForm" enctype="multipart/form-data" class="card p-3 mb-4">
        <div class="row g-3">
            <div class="col-md-6">
                <label>Nama Software</label>
                <input type="text" name="name" class="form-control" required>
            </div>
            <div class="col-md-3">
                <label>Versi</label>
                <input type="text" name="version" class="form-control">
            </div>
            <div class="col-md-3">
                <label>Kategori</label>
                <input type="text" name="category" class="form-control">
            </div>
            <div class="col-12">
                <label>Deskripsi</label>
                <textarea name="description" class="form-control" rows="2"></textarea>
            </div>
            <div class="col-md-4">
                <label>File Path</label>
                <input type="text" name="file_path" class="form-control" placeholder="/repo/...">
            </div>
            <div class="col-md-3">
                <label>Ukuran</label>
                <input type="text" name="size" class="form-control" placeholder="100 MB">
            </div>
            <div class="col-md-3">
                <label>Tags (pisahkan dengan koma)</label>
                <input type="text" name="tags" class="form-control" placeholder="office, productivity">
            </div>
            <div class="col-md-2">
                <label>Gambar</label>
                <input type="file" name="image" class="form-control">
            </div>
        </div>
        <button type="submit" class="btn btn-success mt-3">Tambah</button>
    </form>

    <!-- TABEL LIST SOFTWARE -->
    <div class="card p-3">
        <h5>Daftar Software</h5>
        <table class="table table-striped" id="softwareTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nama</th>
                    <th>Kategori</th>
                    <th>Tags</th>
                    <th>Size</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script>
async function loadSoftware() {
    const res = await axios.get('/api/admin/software');
    const tbody = document.querySelector('#softwareTable tbody');
    tbody.innerHTML = '';
    res.data.forEach(s => {
        tbody.innerHTML += `
            <tr>
                <td>${s.id}</td>
                <td>${s.name}</td>
                <td>${s.category || '-'}</td>
                <td>${s.tags || '-'}</td>
                <td>${s.size || '-'}</td>
                <td>
                    <button class="btn btn-sm btn-danger" onclick="deleteSoftware(${s.id})">üóëÔ∏è</button>
                </td>
            </tr>`;
    });
}

async function deleteSoftware(id) {
    if (!confirm('Yakin ingin menghapus software ini?')) return;
    await axios.delete('/api/admin/software/' + id);
    loadSoftware();
}

document.querySelector('#addForm').addEventListener('submit', async e => {
    e.preventDefault();
    const form = e.target;
    const formData = new FormData(form);
    await axios.post('/api/admin/software', formData);
    form.reset();
    loadSoftware();
});

loadSoftware();
</script>
</body>
</html>
